<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>计算格林函数</title>

    
    <link rel="dns-prefetch" href="https://maxcdn.bootstrapcdn.com/" />
    <link rel="preconnect" href="https://maxcdn.bootstrapcdn.com/" />
    <link rel="dns-prefetch" href="https://unpkg.com/" />
    <link rel="preconnect" href="https://unpkg.com/" />
    
    <link rel="prefetch" href="https://unpkg.com/lunr/lunr.js" />
    <link rel="prefetch" href="http://oh-my-cap.wangliang.one/js/search.min.js" />
    <link rel="prefetch" href="http://oh-my-cap.wangliang.one/index.json" />
    <meta name="description" itemprop="description" content="&lt;p&gt;使用 gCAP 反演震源机制的第一步是正确计算格林函数。默认情况下，本项目中 gCAP 将 &lt;code&gt;Glib&lt;/code&gt; 作为格林函数库所在目录。&lt;/p&gt;  &lt;p&gt;&lt;/p&gt;" id="desc"><meta name="generator" content="Hugo 0.25.1" /><link rel="canonical" href="http://oh-my-cap.wangliang.one/procedures/gflib/">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="prefetch stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    
    <link rel="prefetch stylesheet" type="text/css" href="http://oh-my-cap.wangliang.one/styles.css">

    <script>var _paq = undefined;</script></head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <div id="site-container">
      <div id="site-header">
        <header class="small-text-center medium-text-left">
          <a href="http://oh-my-cap.wangliang.one">
            <span id="site-title" itemprop="name">Oh My CAP</span>
            <br/><span id="site-tagline">世间最庄严的问题是：我能做什么好事？</span>
          </a>
        </header>
        <label for="menu-toggle-box"><div id="menu-toggle" class="main-nav no-select"><span><span class="fa fa-bars"></span> MENU</span></div></label>
        <input type="checkbox" id="menu-toggle-box" class="hide"/>
        <nav id="main-nav">
          <ul class="menu"><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E5%8D%9A%E5%AE%A2" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/post/" >
      <span>博客</span><label for="nav-%E5%8D%9A%E5%AE%A2">
        &nbsp;&nbsp;<span class="nav-arrow">&#9656;</span>
      </label></a><ul>
    <li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E9%A1%B9%E7%9B%AE%E7%BD%91%E7%AB%99%E5%85%A8%E9%9D%A2%E6%94%B9%E7%89%88" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/post/new-website/" >
      <span>项目网站全面改版</span></a></li>
    </ul></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/about/" >
      <span>新手入门</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E5%AE%89%E8%A3%85" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/install/" >
      <span>安装</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/quick-start/" >
      <span>快速开始</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E6%B5%81%E7%A8%8B" class="hide"/>
    <a class="main-nav button active" tabindex="0" href="http://oh-my-cap.wangliang.one/procedures/" >
      <span>流程</span><label for="nav-%E6%B5%81%E7%A8%8B">
        &nbsp;&nbsp;<span class="nav-arrow">&#9656;</span>
      </label></a><ul>
    <li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/procedures/intro-to-procedures/" >
      <span>流程介绍</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E8%AE%A1%E7%AE%97%E6%A0%BC%E6%9E%97%E5%87%BD%E6%95%B0" class="hide"/>
    <a class="main-nav button active" tabindex="0" href="http://oh-my-cap.wangliang.one/procedures/gflib/" >
      <span>计算格林函数</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/procedures/preprocess/" >
      <span>数据预处理</span></a></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E5%8F%8D%E6%BC%94" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/procedures/inversion/" >
      <span>反演</span></a></li>
    </ul></li><li class="no-select" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <input type="checkbox" id="nav-%E4%BB%A3%E7%A0%81%E5%B7%AE%E5%BC%82" class="hide"/>
    <a class="main-nav button" tabindex="0" href="http://oh-my-cap.wangliang.one/code-diffs/" >
      <span>代码差异</span></a></li></ul>
        </nav>
      </div>
      <div id="main-container" class="row" role="main" itemprop="mainContentOfPage">
        
        
        
<main class="row-item small-full medium-two-thirds" >
  <article id="post-article" itemscope itemtype="http://schema.org/Article" itemref="desc">
    <header id="page-header">
      <h1 itemprop="headline">计算格林函数</h1><p id="post-metadata" class="row"><span class="row-item">
          <span class="fa fa-folder"></span>
          <a href="http://oh-my-cap.wangliang.one/categories/pages" rel="category">Pages</a>
        </span><span class="row-item">Estimated reading time: ~<span itemprop="timeRequired">1 minutes</span></span></p>
      
    </header>
    
    <div id="post-content"><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#文件说明">文件说明</a>
<ul>
<li><a href="#一维地层模型文件">一维地层模型文件</a></li>
<li><a href="#格林函数计算脚本">格林函数计算脚本</a></li>
</ul></li>
<li><a href="#计算示例格林函数">计算示例格林函数</a></li>
<li><a href="#格林函数库">格林函数库</a></li>
</ul></li>
</ul>
</nav>
      <span itemprop="articleBody"><p>使用 gCAP 反演震源机制的第一步是正确计算格林函数。默认情况下，本项目中 gCAP 将 <code>Glib</code> 作为格林函数库所在目录。</p>

<p></p>

<h2 id="文件说明">文件说明</h2>

<p><code>Glib</code> 目录下包含了一个格林函数的示例 <code>model.fk</code>。</p>

<p>在 <code>Glib/model</code> 目录下，有两个文件： <code>model</code> 和 <code>run_fk.pl</code> 。前者是一维地层模型文件，后者是计算该模型下的格林函数所需的脚本。</p>

<h3 id="一维地层模型文件">一维地层模型文件</h3>

<p>一维地层模型文件的格式为：</p>

<pre><code>地层厚度  S波速度  P波速度  密度  S波Q值  P波Q值
</code></pre>

<p>其中，后三项可以省略：</p>

<p>例如 <code>Glib/model/model</code> 是一个具有四层的一维地层模型，其内容为：</p>

<pre><code> 5.5 3.18 5.50 2.53 600 1200
10.5 3.64 6.30 2.79 600 1200
16.0 3.87 6.70 2.91 600 1200
90.0 4.50 7.80 3.27 900 1800
</code></pre>

<h3 id="格林函数计算脚本">格林函数计算脚本</h3>

<p><code>Glib/model/run_fk.pl</code> 中调用了 fk 程序以实现格林函数的计算。关于 fk 的详细用法，请参考 <a href="https://seisman.info/fk-notes.html">fk用法笔记</a> 。</p>

<p>示例脚本 <code>Glib/model/run_fk.pl</code> 计算的格林函数参数如下：</p>

<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
</tr>
</thead>

<tbody>
<tr>
<td>模型文件</td>
<td>model</td>
</tr>

<tr>
<td>震源</td>
<td>双力偶源和爆炸源</td>
</tr>

<tr>
<td>震中距范围</td>
<td>5 - 415 km，间隔 5 km</td>
</tr>

<tr>
<td>深度</td>
<td>5 - 30 km，间隔 5 km</td>
</tr>

<tr>
<td>数据点数(npts)</td>
<td>512</td>
</tr>

<tr>
<td>采样间隔(dt)</td>
<td>0.2</td>
</tr>
</tbody>
</table>

<h2 id="计算示例格林函数">计算示例格林函数</h2>

<p>运行脚本 <code>run_fk.pl</code> 即可计算得到示例所需的格林函数。</p>

<pre><code>$ perl run_fk.pl
</code></pre>

<p>如果安装了 Perl 的并行模块 Parallel::ForkManager，你可以使用脚本 <code>run_parallel.pl</code>，用并行的方式完成上述计算（差别仅限于提高了运算速度，结果一样）：</p>

<pre><code>$perl run_parallel.pl
</code></pre>

<h2 id="格林函数库">格林函数库</h2>

<p>执行完 <code>run_fk.pl</code> 后会得到 6 个名为 <code>model_xx</code>（<code>xx</code> 代表震源深度）的文件夹，其中包含了震源深度取不同值所对应的格林函数。</p>

<p>以 <code>model_05</code> 目录为例，其中包含了众多文件名为 <code>xxx.grn.x</code> 的格林函数文件。其中：</p>

<ul>
<li><code>xxx</code> 代表震中距</li>
<li><code>x</code> 取0-8，对应双力偶震源的9个格林函数分量</li>
<li><code>x</code> 取a、b、c，对应爆炸源的3个格林函数分量</li>
</ul>

<p>所有格林函数均是 SAC 格式，其中 <code>xxx.grn.0</code> 和 <code>xxx.grn.5</code> 的SAC 头段 <code>t1</code> 和 <code>t2</code> 中分别保存了初至 P 波和 初至 S 波的到时，SAC 头段 <code>user1</code> 和 <code>user2</code> 中保存了初至 P 波和初至 S 波的离源角（相对于垂直向下方向旋转的角度)。</p>

<p>gCAP 可以根据 SAC 头段 <code>t1</code> 和 <code>t2</code> 的值自动确定要截取的波形时间窗；若反演中需要使用震相初动极性信息，则需要从 SAC 头段 <code>user1</code> 和 <code>user2</code> 中读取震相离源角。</p></span>
    </div><div id="authorbox" class="row vcenter memberbox" itemprop="author" itemscope itemtype="http://schema.org/Person">
    		<div class="row-item member-avatar" itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
    				<img alt="王亮 avatar" src="http://oh-my-cap.wangliang.one/images/profile.jpg" itemprop="contentUrl" />
    		</div>
    		<div class="row-item member-bio">
    			<div>
    				<span class="widget-title">About <span itemprop="name">王亮</span></span>
    			</div>
    			<p itemprop="description">
I&#39;m a PHD candidate from CDUT.
</p>
    		</div>
    	</div></article>

  </main>

        <aside class="row-item small-full medium-third right" itemscope itemtype="http://schema.org/WPSideBar">
  
  <div class="widget" id="search-container">
  <header>
		<span class="widget-header"><span class="fa fa-search"></span> Search</span>
	</header>
	<input type="search" name="search" id="searchbox" placeholder="Search..." autocomplete="off"/>
  <div id="search-results" class="hide"></div>
</div>
	<div class="widget">
	<header>
		<span class="widget-header"><span class="fa fa-pencil"></span> <a href="http://oh-my-cap.wangliang.one/post/">Recent Posts</a></span>
	</header>
	
	<a class="widget-header-small button" href="http://oh-my-cap.wangliang.one/index.xml"><span class="fa fa-rss"></span> Subscribe to the Site</a>
	<ul><li><a href="http://oh-my-cap.wangliang.one/post/new-website/">项目网站全面改版</a></li></ul>
</div>
  
	
	
</aside>

      </div>
      <footer class="row">
        <div class="small-full medium-half row-item small-text-center medium-text-left medium-left">
          <small>
            &copy; 2017
            <span itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
              <span itemprop="name">Oh My CAP</span>
            </span>
          </small>
        </div>
        
        <div class="small-full medium-half row-item small-text-center medium-text-right" id="social-icons">
          
          
          <a href="https://github.com/wangliang1989/oh-my-cap" rel="me nofollow">
            <span class="fa fa-github"></span>
          </a>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </div>
      </footer>
    </div><script src="https://unpkg.com/lunr/lunr.js"></script>
    <script src="http://oh-my-cap.wangliang.one/js/search.js" type="text/javascript"></script>
    
    <script>
      var lunrIndex = undefined;
      loadIndex("http:\/\/oh-my-cap.wangliang.one\/index.json").then(
        function(index) { lunrIndex = index; },
        function(status){}
      );
    </script></body>
</html>
